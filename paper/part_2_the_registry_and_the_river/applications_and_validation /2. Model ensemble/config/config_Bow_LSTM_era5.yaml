### ============================================= SYMFLUENCE configuration file ============================================================
# LSTM Model Configuration for Bow at Banff - Multi-model ensemble experiment
# VERSION 2: Improved hyperparameters to address gradient vanishing issue
# Changes from v1:
#   - Reduced LSTM_NUM_LAYERS: 3 -> 2 (less gradient vanishing)
#   - Reduced LSTM_LEARNING_RATE: 0.001 -> 0.0005 (more stable learning)
#   - Increased LSTM_EPOCHS: 300 -> 500 (more training time)
#   - Increased LSTM_LEARNING_PATIENCE: 30 -> 50 (more patience)
#   - Reduced LSTM_DROPOUT: 0.2 -> 0.15 (allow gradients to flow)
#   - Reduced LSTM_HIDDEN_SIZE: 128 -> 96 (simpler model, easier to train)
#   - Increased LSTM_L2_REGULARIZATION: 1e-6 -> 1e-5 (prevent collapse)
### ============================================= 1. Global settings: =====================================================================

# Main paths
SYMFLUENCE_DATA_DIR: "/Users/darrieythorsson/compHydro/code/SYMFLUENCE_data/"
SYMFLUENCE_CODE_DIR: "/Users/darrieythorsson/compHydro/code/SYMFLUENCE"

# Experiment settings
DOMAIN_NAME: Bow_at_Banff_lumped_era5
EXPERIMENT_ID: run_2
EXPERIMENT_TIME_START: 2002-01-01 01:00
EXPERIMENT_TIME_END: 2009-12-31 23:00
CALIBRATION_PERIOD: 2004-01-01, 2007-12-31
EVALUATION_PERIOD:  2008-01-01, 2009-12-31
SPINUP_PERIOD: 2002-01-01, 2003-12-31

# Computational settings
MPI_PROCESSES: 1
FORCE_RUN_ALL_STEPS: False

### ============================================= 2. Geospatial settings: =================================================================
# Coordinate settings
POUR_POINT_COORDS: 51.1722/-115.5717
BOUNDING_BOX_COORDS: 51.76/-116.55/50.95/-115.5

# Pour point shapefile path
POUR_POINT_SHP_PATH: default
POUR_POINT_SHP_NAME: default

# Domain representation settings
DOMAIN_DEFINITION_METHOD: lumped
ROUTING_DELINEATION: lumped

GEOFABRIC_TYPE: TDX
STREAM_THRESHOLD: 5000
LUMPED_WATERSHED_METHOD: TauDEM
CLEANUP_INTERMEDIATE_FILES: True
DELINEATE_BY_POURPOINT: True
MOVE_OUTLETS_MAX_DISTANCE: 200
MIN_GRU_SIZE: 1

# Domain discretization settings
SUB_GRID_DISCRETIZATION: GRUS
ELEVATION_BAND_SIZE: 200
MIN_HRU_SIZE: 4
RADIATION_CLASS_NUMBER: 5
ASPECT_CLASS_NUMBER: 8
ASPECT_PATH: default

# Shapefile settings - Catchment shape
CATCHMENT_PATH: default
CATCHMENT_SHP_NAME: default
CATCHMENT_SHP_LAT: center_lat
CATCHMENT_SHP_LON: center_lon
CATCHMENT_SHP_AREA: HRU_area
CATCHMENT_SHP_HRUID: HRU_ID
CATCHMENT_SHP_GRUID: GRU_ID

# Shapefile settings - Basins shape
RIVER_BASINS_PATH: default
RIVER_BASINS_NAME: default
RIVER_BASIN_SHP_RM_GRUID: GRU_ID
RIVER_BASIN_SHP_HRU_TO_SEG: gru_to_seg
RIVER_BASIN_SHP_AREA: GRU_area

# Shapefile settings - River network shape
RIVER_NETWORK_SHP_PATH: default
RIVER_NETWORK_SHP_NAME: default
RIVER_NETWORK_SHP_LENGTH: Length
RIVER_NETWORK_SHP_SEGID: LINKNO
RIVER_NETWORK_SHP_DOWNSEGID: DSLINKNO
RIVER_NETWORK_SHP_SLOPE: Slope

# Geospatial data paths
OUTPUT_BASINS_PATH: default
OUTPUT_RIVERS_PATH: default
DEM_PATH: default
DEM_NAME: default
SOURCE_GEOFABRIC_BASINS_PATH: /Users/darrieythorsson/compHydro/data/CWARHM_data/domain_NorthAmerica/shapefiles/catchment/8020000010-basins.gpkg
SOURCE_GEOFABRIC_RIVERS_PATH: /Users/darrieythorsson/compHydro/data/CWARHM_data/domain_NorthAmerica/shapefiles/river_network/8020000010-streamnet.gpkg
TAUDEM_DIR: default
OUTPUT_DIR: default
CATCHMENT_PLOT_DIR: default
SOIL_CLASS_PATH: default
SOIL_CLASS_NAME: default
LAND_CLASS_PATH: default
LAND_CLASS_NAME: default
RADIATION_PATH: default

# Tool paths
DATATOOL_PATH: default
GISTOOL_PATH: default
EASYMORE_CLIENT: easymore cli
DATATOOL_DATASET_ROOT: /work/comphyd_lab/data/meteorological-data/
DATATOOL_CACHE: /home/darri.eythorsson
TOOL_ACCOUNT: def-mclark
GISTOOL_DATASET_ROOT: /work/comphyd_lab/data/geospatial-data/
GISTOOL_LIB_PATH: /work/comphyd_lab/envs/r-env/
TOOL_CACHE: /home/darri.eythorsson/cache
EASYMORE_CACHE: /home/darri.eythorsson/easymore/
EASYMORE_JOB_CONF: "installs/MAF/02_model_agnostic_component/easymore-job.slurm"
CLUSTER_JSON: /work/comphyd_lab/users/darri/data/SYMFLUENCE_data/installs/datatool/etc/clusters/ucalgary-arc.json

### ============================================= 3. Model Agnostic settings: =============================================================

# Forcing data settings
FORCING_DATASET: ERA5
FORCING_VARIABLES: default
FORCING_MEASUREMENT_HEIGHT: 2
FORCING_TIME_STEP_SIZE: 3600
APPLY_LAPSE_RATE: True
LAPSE_RATE: 0.0065
FORCING_SHAPE_LAT_NAME: lat
FORCING_SHAPE_LON_NAME: lon
FORCING_PATH: default

# EM-Earth forcing supplementation settings
SUPPLEMENT_FORCING: False
EM_EARTH_PRCP_DIR: "/anvil/datasets/meteorological/EM-Earth/EM_Earth_v1/deterministic_hourly/prcp/NorthAmerica"
EM_EARTH_TMEAN_DIR: "/anvil/datasets/meteorological/EM-Earth/EM_Earth_v1/deterministic_hourly/tmean/NorthAmerica"

# Intersection paths
INTERSECT_SOIL_PATH: default
INTERSECT_SOIL_NAME: catchment_with_soilclass.shp
INTERSECT_ROUTING_PATH: default
INTERSECT_ROUTING_NAME: catchment_with_routing_basins.shp
INTERSECT_DEM_PATH: default
INTERSECT_DEM_NAME: catchment_with_dem.shp
INTERSECT_LAND_PATH: default
INTERSECT_LAND_NAME: catchment_with_landclass.shp

### ============================================= 4. Model Specific settings: =============================================================

# Model settings
HYDROLOGICAL_MODEL: LSTM
ROUTING_MODEL: none                                            # LSTM handles its own predictions

# LSTM neural network settings - IMPROVED FOR GRADIENT STABILITY
LSTM_LOAD: False                                               # Train fresh model
LSTM_HIDDEN_SIZE: 96                                           # Reduced from 128 (simpler model)
LSTM_NUM_LAYERS: 2                                             # Reduced from 3 (less gradient vanishing)
LSTM_EPOCHS: 500                                               # Increased from 300 (more training time)
LSTM_BATCH_SIZE: 64                                            # Keep same batch size
LSTM_LEARNING_RATE: 0.0005                                     # Reduced from 0.001 (more stable)
LSTM_LEARNING_PATIENCE: 50                                     # Increased from 30 (more patience)
LSTM_LOOKBACK: 365                                             # Keep same lookback window
LSTM_DROPOUT: 0.15                                             # Reduced from 0.2 (allow gradients)
LSTM_L2_REGULARIZATION: 1e-5                                   # Increased from 1e-6 (prevent collapse)
LSTM_USE_ATTENTION: True                                       # Keep attention mechanism
LSTM_USE_SNOW: False                                           # Include snow features

# LSTM paths
SETTINGS_LSTM_PATH: default
EXPERIMENT_OUTPUT_LSTM: default

### ============================================= 5. Evaluation settings: =================================================================

# Simulation settings
SIM_REACH_ID: 228
SIMULATIONS_PATH: default

# Observation data settings
OBSERVATIONS_PATH: default

# Observation data paths
STREAMFLOW_DATA_PROVIDER: WSC
DOWNLOAD_USGS_DATA: True
DOWNLOAD_WSC_DATA: True
STATION_ID: 05BB001
STREAMFLOW_RAW_PATH: default
STREAMFLOW_RAW_NAME: default
STREAMFLOW_PROCESSED_PATH: default
HYDAT_PATH: /work/comphyd_lab/data/geospatial-data/hydat/Hydat.sqlite3

### ============================================= 6. Optimization settings: ===============================================================

# LSTM uses neural network training, not traditional calibration
# But we still specify metric targets for evaluation
OPTIMIZATION_METHODS: [iteration]
OPTIMIZATION_METRIC: KGE
TARGET_METRIC: KGE

# LSTM hyperparameter tuning bounds (for Optuna/hyperparameter optimization)
LSTM_PARAM_BOUNDS:
  hidden_size: [64, 256]                                       # Hidden layer size range
  num_layers: [1, 3]                                           # Reduced upper bound from 4 to 3
  learning_rate: [0.0001, 0.005]                               # Narrowed range for stability
  dropout: [0.1, 0.3]                                          # Reduced upper bound from 0.4
  lookback: [180, 730]                                         # Lookback window range (days)
