# ================================================================================
# Fyrisån Uppsala E2E Test Configuration
# Full 5-year SUMMA lumped model with 1000-iteration optimization
# ================================================================================
# Test validates complete workflow:
# - Lumped basin delineation (Fyrisån, Uppsala, Sweden)
# - Cloud data acquisition (Copernicus DEM, MODIS, CERRA forcing, WSC streamflow)
# - SUMMA preprocessing and execution
# - 1000-iteration DDS optimization
# ================================================================================

# Experiment metadata
EXPERIMENT_ID: fyris_full_example
DOMAIN_NAME: fyris_uppsala


# Domain definition - Lumped basin
DOMAIN_DEFINITION_METHOD: lumped
ROUTING_DELINEATION: lumped
SUB_GRID_DISCRETIZATION: GRUs
POUR_POINT_COORDS: 59.869999/17.62067  # Fyrisån at Uppsala, Sweden
BOUNDING_BOX_COORDS: 60.1/17.59/59.86/18.1  # north/west/south/east
DELINEATE_BY_POURPOINT: true
DELINEATION_METHOD: stream_threshold
STREAM_THRESHOLD: 5000
LUMPED_WATERSHED_METHOD: TauDEM
GEOFABRIC_TYPE: na

# Time periods (2 years total: 2016-2017)
EXPERIMENT_TIME_START: '2016-01-01 00:00'
EXPERIMENT_TIME_END: '2017-12-31 21:00'            # Adjusted to match 3-hourly forcing data end
SPINUP_PERIOD: '2016-01-01, 2016-03-31'           # 3 month spinup
CALIBRATION_PERIOD: '2016-04-01, 2017-12-31'
EVALUATION_PERIOD: '2016-04-01, 2017-12-31'
CALIBRATION_TIMESTEP: daily

# Cloud data access
DATA_ACCESS: cloud
DEM_SOURCE: copernicus
DOWNLOAD_DEM: true
DOWNLOAD_SOIL: true
DOWNLOAD_LAND_COVER: true
LAND_CLASS_SOURCE: modis

# Forcing dataset - CERRA (European Regional Reanalysis)
FORCING_DATASET: CERRA
FORCING_TIME_STEP_SIZE: 10800  # 3-hourly timestep for CERRA
FORCING_MEASUREMENT_HEIGHT: 2

# Observations - SMHI streamflow (Sweden)
STATION_ID: '2609'  # Fyrisån at Uppsala Bärbyleden
STREAMFLOW_DATA_PROVIDER: SMHI
DOWNLOAD_SMHI_DATA: true
ADDITIONAL_OBSERVATIONS: ESA_CCI_SM
DOWNLOAD_SMAP: false
DOWNLOAD_ESA_CCI_SM: true
ESA_CCI_SM_PATH: default
ESA_CCI_SM_VARIABLE: surface_soil_moisture_volumetric
ESA_CCI_SM_SENSOR: combined
ESA_CCI_SM_TIME_AGGREGATION: daily
ESA_CCI_SM_RECORD_TYPE: cdr
ESA_CCI_SM_VERSION: v202312
FORCE_DOWNLOAD: false
DOWNLOAD_ISMN: true
ISMN_API_BASE: https://ismn.earth/dataviewer
ISMN_METADATA_URL: https://ismn.earth/static/dataviewer/network_station_details.json
ISMN_VARIABLE_LIST_URL: https://ismn.earth/dataviewer/dataviewer_get_variable_list/
ISMN_MAX_STATIONS: 1
ISMN_SEARCH_RADIUS_KM: 1000
ISMN_TARGET_DEPTH_M: 0.05
ISMN_TEMPORAL_AGGREGATION: daily_mean

# Disable other observation sources
DOWNLOAD_USGS_DATA: false
DOWNLOAD_SNOTEL: false
DOWNLOAD_MODIS_SNOW: false
DOWNLOAD_GRACE: false
DOWNLOAD_USGS_GW: false

# Model configuration - NGEN with all modules
HYDROLOGICAL_MODEL: SUMMA
NGEN_INSTALL_PATH: default
NGEN_EXE: ngen

# NGEN module settings - Enable all modules for comprehensive physics
NGEN_MODULES_TO_CALIBRATE: CFE,PET,NOAH                        # Comma-separated list of modules to calibrate

# CFE parameters to calibrate (10 parameters)
NGEN_CFE_PARAMS_TO_CALIBRATE: maxsmc,satdk,bb,slop,Cgw,max_gw_storage,K_nash,K_lf,alpha_fc,wltsmc
# CFE key parameters: maxsmc (soil moisture capacity), satdk (hydraulic conductivity), bb (pore size index)
#                     slop (TOPMODEL slope), Cgw (groundwater coeff), max_gw_storage (GW storage depth)
#                     K_nash (Nash routing), K_lf (lateral flow), alpha_fc (field capacity), wltsmc (wilting point)

# PET parameters to calibrate (3 parameters)
NGEN_PET_PARAMS_TO_CALIBRATE: vegetation_height_m,surface_shortwave_albedo,momentum_transfer_roughness_length
# PET key parameters: vegetation_height_m (0.1-30m, forest/grassland canopy height)
#                     surface_shortwave_albedo (0.05-0.5, reflectivity)
#                     momentum_transfer_roughness_length (0.001-2.0m, aerodynamic roughness)

# NOAH-OWP parameters to calibrate (4 parameters)
NGEN_NOAH_PARAMS_TO_CALIBRATE: refkdt,slope,smcmax,dksat
# NOAH key parameters: refkdt (0.5-3.0, surface runoff parameter)
#                      slope (0.1-1.0, slope parameter)
#                      smcmax (0.3-0.55, max soil moisture)
#                      dksat (1e-7-1e-4 m/s, saturated hydraulic conductivity)
# NOTE: SLOTH module runs with fixed parameters (no calibration params defined)

# SUMMA settings (NOT USED - keeping for backwards compatibility)
SUMMA_EXE: summa_sundials.exe
SUMMA_INSTALL_PATH: default
SETTINGS_SUMMA_PATH: default
SETTINGS_SUMMA_GRU_COUNT: 1
SETTINGS_SUMMA_USE_PARALLEL_SUMMA: false

# Routing
ROUTING_MODEL: none

# Optimization configuration - 17 parameter calibration
OPTIMIZATION_METHODS: ['iteration']
ITERATIVE_OPTIMIZATION_ALGORITHM: ASYNC-DDS
OPTIMIZATION_METRIC: correlation
OPTIMIZATION_TARGET: sm_esa
EVALUATION_DATA: ['soil_moisture']
NUMBER_OF_ITERATIONS: 500  # Increased for 17-parameter space

# DDS algorithm settings
DDS_R: 0.2
ASYNC_DDS_POOL_SIZE: 10
ASYNC_DDS_BATCH_SIZE: 10
MAX_STAGNATION_BATCHES: 10

# NGEN calibration: 17 total parameters (10 CFE + 3 PET + 4 NOAH)
# SUMMA parameters (NOT USED - commented out for reference)
PARAMS_TO_CALIBRATE: k_soil,theta_sat
# BASIN_PARAMS_TO_CALIBRATE: routingGammaScale

# Project paths
SYMFLUENCE_CODE_DIR: default
SYMFLUENCE_DATA_DIR: default
OUTPUT_DIR: default

# Analysis and reporting
ANALYSES: [benchmarking, attributes, visualization, optimization]

# Other settings
LOG_LEVEL: INFO
RANDOM_SEED: null
FORCE_RUN_ALL_STEPS: false
NUM_PROCESSES: 10
SUPPLEMENT_FORCING: false
