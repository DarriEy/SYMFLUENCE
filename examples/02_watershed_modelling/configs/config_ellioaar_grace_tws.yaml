# ================================================================================
# Elliðaár Iceland E2E Test Configuration
# Full 5-year SUMMA lumped model with 1000-iteration optimization
# Modified for GRACE TWS Optimization
# ================================================================================

# Experiment metadata
EXPERIMENT_ID: ellioaar_grace_example
DOMAIN_NAME: ellioaar_iceland

# Domain definition - Lumped basin
DOMAIN_DEFINITION_METHOD: lumped
SUB_GRID_DISCRETIZATION: GRUs
POUR_POINT_COORDS: 64.123985/-21.840954  # Elliðaár at Reykjavik, Iceland
BOUNDING_BOX_COORDS: 64.13/-21.95/64.11/-21.80  # north/west/south/east
DELINEATE_BY_POURPOINT: true
DELINEATION_METHOD: stream_threshold
STREAM_THRESHOLD: 5000
LUMPED_WATERSHED_METHOD: TauDEM
GEOFABRIC_TYPE: na
ROUTING_DELINEATION: lumped

# Time periods (5 years total: 2015-2019)
EXPERIMENT_TIME_START: '2015-01-01 00:00'
EXPERIMENT_TIME_END: '2019-12-31 23:00'
SPINUP_PERIOD: '2015-01-01, 2015-12-31'           # 1 year spinup
CALIBRATION_PERIOD: '2016-01-01, 2017-12-31'       # 2 year calibration
EVALUATION_PERIOD: '2018-01-01, 2019-12-31'        # 2 year evaluation
CALIBRATION_TIMESTEP: daily

# Cloud data access
DATA_ACCESS: cloud
DEM_SOURCE: copernicus
DOWNLOAD_DEM: true
DOWNLOAD_SOIL: true
DOWNLOAD_LAND_COVER: true
LAND_CLASS_SOURCE: modis

# Forcing dataset - CARRA (Arctic Regional Reanalysis)
FORCING_DATASET: CARRA
CARRA_DOMAIN: west_domain
FORCING_TIME_STEP_SIZE: 10800  # 3-hour timestep for CARRA
FORCING_MEASUREMENT_HEIGHT: 2

# Observations - LamaH-ICE streamflow (Iceland)
STATION_ID: '13'  # Elliðaár at Reykjavik
STREAMFLOW_DATA_PROVIDER: LAMAH_ICE
LAMAH_ICE_PATH: default
DOWNLOAD_LAMAH_ICE_DATA: true

# Enable GRACE
DOWNLOAD_GRACE: true
FORCE_DOWNLOAD: false
GRACE_SUBSET: true
# Additional observations: GRACE + ET datasets (select one or multiple)
ADDITIONAL_OBSERVATIONS: [GRACE, GLEAM_ET, GGMN]
# GLEAM ET configuration
GLEAM_ET_DOWNLOAD_URL: https://zenodo.org/api/records/7099512/files/E_GLEAM_v3.tar.gz/content
GLEAM_ET_PATH: default
# ET observation paths (relative to project directory)
ET_OBS_PATH: default
# Alternative ET sources (uncomment one if switching datasets):
# For MODIS ET:
# ADDITIONAL_OBSERVATIONS: [GRACE, MODIS_ET]
# MODIS_ET_DIR: default
# For FLUXCOM ET:
# ADDITIONAL_OBSERVATIONS: [GRACE, FLUXCOM_ET]
# FLUXCOM_ET_PATH: default
CATCHMENT_PATH: default
CATCHMENT_SHP_NAME: ellioaar_iceland_HRUs_GRUs.shp

# Disable other observation sources
DOWNLOAD_USGS_DATA: false
DOWNLOAD_SNOTEL: false
DOWNLOAD_MODIS_SNOW: false
DOWNLOAD_USGS_GW: false

# Model configuration - SUMMA lumped
HYDROLOGICAL_MODEL: SUMMA
SUMMA_EXE: summa_sundials.exe
SUMMA_INSTALL_PATH: default
SETTINGS_SUMMA_PATH: default
SETTINGS_SUMMA_GRU_COUNT: 1  # Lumped basin = 1 GRU
SETTINGS_SUMMA_USE_PARALLEL_SUMMA: false
SETTINGS_SUMMA_ATTRIBUTES: attributes.nc
SETTINGS_SUMMA_BASIN_PARAMS_FILE: basinParamInfo.txt
SETTINGS_SUMMA_LOCAL_PARAMS_FILE: localParamInfo.txt
SETTINGS_SUMMA_FILEMANAGER: fileManager.txt
SETTINGS_SUMMA_FORCING_LIST: forcingFileList.txt

# Routing
ROUTING_MODEL: mizuRoute

# Optimization configuration - GRACE TWS with ET observations
OPTIMIZATION_METHODS: ['iteration']
ITERATIVE_OPTIMIZATION_ALGORITHM: ASYNC-DDS
OPTIMIZATION_METRIC: KGE
OPTIMIZATION_TARGET: tws
EVALUATION_DATA: ['tws']
# ET data is also acquired via ADDITIONAL_OBSERVATIONS (see above) for multi-objective potential
ET_OBS_SOURCE: gleam  # Source of ET observations (gleam, fluxcom, modis_et)
ET_UNIT_CONVERSION: 1.0  # Conversion factor to mm/day if needed
NUMBER_OF_ITERATIONS: 500

# DDS algorithm settings
DDS_R: 0.2
ASYNC_DDS_POOL_SIZE: 10
ASYNC_DDS_BATCH_SIZE: 10
MAX_STAGNATION_BATCHES: 10

# Parameters to calibrate (14 total)
PARAMS_TO_CALIBRATE: k_soil,theta_sat,critSoilTranspire,aquiferBaseflowRate,z0Snow,Fcapil,frozenPrecipMultip,tempCritRain,tempRangeTimestep,albedoMax,albedoMinWinter
BASIN_PARAMS_TO_CALIBRATE: routingGammaScale,basin__aquiferBaseflowExp,basin__aquiferScaleFactor

# Parameter bounds to prevent physical inconsistencies
PARAMETER_BOUNDS:
  theta_sat: [0.45, 0.65]
  critSoilTranspire: [0.15, 0.40]  # Guaranteed to be > theta_res (0.039) and < theta_sat (min 0.45)

# Project paths
SYMFLUENCE_CODE_DIR: default
SYMFLUENCE_DATA_DIR: default
OUTPUT_DIR: default

# Analysis and reporting
ANALYSES: [benchmarking, attributes, visualization, optimization]

# Other settings
LOG_LEVEL: DEBUG
RANDOM_SEED: null
FORCE_RUN_ALL_STEPS: false
NUM_PROCESSES: 10
SUPPLEMENT_FORCING: false
