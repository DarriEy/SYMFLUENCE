# ================================================================================
# SCA (Snow Cover Area) Calibration Test Configuration
# SUMMA model calibrated against merged MODIS MOD10A1 + MYD10A1 snow cover data
# ================================================================================

# Experiment metadata
EXPERIMENT_ID: sca_modis_example
DOMAIN_NAME: bow_at_banff

# Domain definition - Lumped basin (snow-dominated, Canadian Rockies)
DOMAIN_DEFINITION_METHOD: lumped
DOMAIN_DISCRETIZATION: GRUs
POUR_POINT_COORDS: 51.1784/-115.5708  # Bow River at Banff, Alberta
BOUNDING_BOX_COORDS: 51.85/-116.50/51.00/-115.20  # north/west/south/east
DELINEATE_BY_POURPOINT: true
DELINEATION_METHOD: stream_threshold
STREAM_THRESHOLD: 5000
LUMPED_WATERSHED_METHOD: TauDEM
GEOFABRIC_TYPE: na
ROUTING_DELINEATION: lumped

# Time periods (5 years for extended testing)
EXPERIMENT_TIME_START: '2015-01-01 00:00'
EXPERIMENT_TIME_END: '2019-12-31 23:00'
SPINUP_PERIOD: '2015-01-01, 2015-12-31'           # 1 year spinup
CALIBRATION_PERIOD: '2016-01-01, 2018-12-31'       # 3 year calibration
EVALUATION_PERIOD: '2019-01-01, 2019-12-31'        # 1 year evaluation
CALIBRATION_TIMESTEP: daily

# Cloud data access
DATA_ACCESS: cloud
DEM_SOURCE: copernicus
DOWNLOAD_DEM: true
DOWNLOAD_SOIL: true
DOWNLOAD_LAND_COVER: true
LAND_CLASS_SOURCE: modis

# Forcing dataset - ERA5 (global coverage)
FORCING_DATASET: ERA5
FORCING_TIME_STEP_SIZE: 3600  # 1-hour timestep for ERA5
FORCING_MEASUREMENT_HEIGHT: 2
ERA5_USE_CDS: false  # Use ARCO pathway (more reliable for long downloads)

# Observations - WSC streamflow (Water Survey of Canada)
STATION_ID: '05BB001'  # Bow River at Banff
STREAMFLOW_DATA_PROVIDER: WSC
DOWNLOAD_WSC_DATA: true

# Enable MODIS SCA (merged Terra + Aqua)
DOWNLOAD_MODIS_SNOW: true
MODIS_SCA_MERGE: true
MODIS_SCA_PRODUCTS: ['MOD10A1.061', 'MYD10A1.061']
MODIS_SCA_MERGE_STRATEGY: max  # Use max SCA when both satellites have data
MODIS_SCA_CLOUD_FILTER: true
MODIS_SCA_MIN_VALID_RATIO: 0.1
MODIS_SCA_NORMALIZE: true  # Convert to fraction (0-1)

# Additional observations (optional - can enable for multi-objective)
ADDITIONAL_OBSERVATIONS: [MODIS_SNOW]
# For multi-objective SCA + Streamflow calibration:
# ADDITIONAL_OBSERVATIONS: [MODIS_SNOW, WSC_STREAMFLOW]

# Disable other observation sources
DOWNLOAD_USGS_DATA: false
DOWNLOAD_SNOTEL: false
DOWNLOAD_GRACE: false
DOWNLOAD_USGS_GW: false

# Model configuration - SUMMA lumped
HYDROLOGICAL_MODEL: SUMMA
SUMMA_EXE: summa_sundials.exe
SUMMA_INSTALL_PATH: default
SETTINGS_SUMMA_PATH: default
SETTINGS_SUMMA_GRU_COUNT: 1  # Lumped basin = 1 GRU
SETTINGS_SUMMA_USE_PARALLEL_SUMMA: false
SETTINGS_SUMMA_ATTRIBUTES: attributes.nc
SETTINGS_SUMMA_BASIN_PARAMS_FILE: basinParamInfo.txt
SETTINGS_SUMMA_LOCAL_PARAMS_FILE: localParamInfo.txt
SETTINGS_SUMMA_FILEMANAGER: fileManager.txt
SETTINGS_SUMMA_FORCING_LIST: forcingFileList.txt

# Routing
ROUTING_MODEL: mizuRoute

# Optimization configuration - SCA calibration
OPTIMIZATION_METHODS: ['iteration']
ITERATIVE_OPTIMIZATION_ALGORITHM: ASYNC-DDS
OPTIMIZATION_METRIC: KGE
OPTIMIZATION_TARGET: sca
EVALUATION_DATA: ['sca']
NUMBER_OF_ITERATIONS: 500

# DDS algorithm settings
DDS_R: 0.2
ASYNC_DDS_POOL_SIZE: 10
ASYNC_DDS_BATCH_SIZE: 10
MAX_STAGNATION_BATCHES: 10

# Snow-related parameters to calibrate
# Focus on parameters controlling snow accumulation, melt, and coverage
PARAMS_TO_CALIBRATE: tempCritRain,tempRangeTimestep,frozenPrecipMultip,albedoMax,albedoMinWinter,albedoDecayRate,z0Snow,newSnowDenMin,newSnowDenMult,Fcapil,snowfrz_scale
BASIN_PARAMS_TO_CALIBRATE: routingGammaScale

# Parameter bounds for snow processes
PARAMETER_BOUNDS:
  tempCritRain: [-2.0, 4.0]         # Temperature threshold for rain vs snow
  tempRangeTimestep: [0.5, 3.0]     # Temperature range for mixed precip
  frozenPrecipMultip: [0.8, 1.5]    # Precipitation undercatch correction
  albedoMax: [0.80, 0.95]           # Maximum fresh snow albedo
  albedoMinWinter: [0.55, 0.75]     # Minimum albedo for old snow (winter)
  albedoDecayRate: [0.5e6, 2.0e6]   # Albedo decay timescale (s)
  z0Snow: [0.0001, 0.01]            # Snow roughness length (m)
  newSnowDenMin: [50.0, 150.0]      # Minimum new snow density (kg/m3)
  newSnowDenMult: [50.0, 150.0]     # Multiplier for new snow density
  Fcapil: [0.01, 0.10]              # Capillary retention fraction
  snowfrz_scale: [10.0, 100.0]      # Snow freezing timescale (s)

# Project paths
SYMFLUENCE_CODE_DIR: /Users/darrieythorsson/compHydro/code/SYMFLUENCE
SYMFLUENCE_DATA_DIR: /Users/darrieythorsson/compHydro/code/SYMFLUENCE_data
OUTPUT_DIR: default

# Analysis and reporting
ANALYSES: [benchmarking, attributes, visualization, optimization]

# Other settings
LOG_LEVEL: DEBUG
RANDOM_SEED: null
FORCE_RUN_ALL_STEPS: false
MPI_PROCESSES: 1  # Use serial processing to avoid pickling issues
SUPPLEMENT_FORCING: false
